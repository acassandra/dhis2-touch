<!--
  Generated template for the DataEntryHome page.

  See http://ionicframework.com/docs/v2/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>

  <ion-navbar color="primary">
    <ion-title>Event Capture Home</ion-title>
  </ion-navbar>

</ion-header>


<ion-content  class="event-capture-home" padding >

  <div *ngIf="loadingData">
    <ion-list>
      <ion-item *ngFor="let message of loadingMessages; let currentIndex = index">
        {{ message }}
        <ion-icon *ngIf="(currentIndex + 1) < loadingMessages.length" name="done-all" item-right color="primary"></ion-icon>
        <div style="text-align: center" item-right *ngIf="(currentIndex + 1) >= loadingMessages.length">
          <ion-spinner name="crescent" color="secondary"></ion-spinner>
        </div>
      </ion-item>
    </ion-list>

  </div>
  <div *ngIf="!loadingData">

    <ion-row >
      <ion-col width="100">
        <button (click)="openOrganisationUnitModal()" ion-button full color="light">
          {{ selectedOrganisationUnitLabel }}
        </button>
      </ion-col>
    </ion-row>
    <ion-row >
      <ion-col width="100">
        <div >
          <button (click)="openProgramsModal()" [disabled] ="!currentSelectionStatus.program" ion-button full color="light">
            {{ selectedProgramLabel }}
          </button>
        </div>
      </ion-col>
    </ion-row>

    <div *ngIf="selectedProgram">
      <div *ngIf="selectedProgram.categoryCombo">
        <div *ngIf="selectedProgram.categoryCombo.categories[0].name !='default'">
          <div *ngFor="let category of selectedProgram.categoryCombo.categories;let categoryIndex = index ">
            <ion-row >
              <ion-col width="100">
                <ion-list>
                  <ion-item >
                    <ion-label>{{ category.name }}</ion-label>
                    <ion-select [(ngModel)]="selectedDataDimension[categoryIndex]" (ionChange)="checkingForDataDimension()" interface="action-sheet">
                      <ion-option *ngFor="let option of category.categoryOptions" value="{{option.id}}" >
                        {{ option.name }}
                      </ion-option>
                    </ion-select>
                  </ion-item>
                </ion-list>
              </ion-col>
            </ion-row>
          </div>
        </div>
      </div>
    </div>

    <!-- guide messages during parameter selection-->
    <div *ngIf="!isAllParameterSet">
      <ion-row >
        <ion-col width="100">
          <ion-item-group >
            <ion-item-divider>
              <ion-icon name="help-circle" color="primary"></ion-icon> &nbsp;&nbsp;
              <b>
                {{ currentSelectionStatus.message }}<span *ngIf="currentSelectionStatus.message==''">Please Select all program dimensions</span>
              </b>
            </ion-item-divider>
          </ion-item-group>
          <ion-list></ion-list>
        </ion-col>
      </ion-row>
    </div>

    <div *ngIf="isAllParameterSet">

      <!-- list options as well as register new event -->
      <ion-row>
        <ion-col>
          <button ion-button full (click)="showFieldSelectionMenu()" color="light">
            <ion-icon name="grid"></ion-icon>
          </button>
        </ion-col>
        <ion-col>
          <button ion-button full (click)="goToEventRegister()" color="favorite">
            <ion-icon name="add"></ion-icon>
          </button>
        </ion-col>
        <ion-col>
          <button ion-button full [disabled]="true">
            <ion-icon name="settings"></ion-icon>
          </button>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col width="100">
          <hr>
        </ion-col>
      </ion-row>

      <!-- notification if no event list found from local as well login instance-->
      <div *ngIf="eventListSections.length == 0">
        <ion-row>
          <ion-col width="100">
            <ion-item-group>
              <ion-item-divider>
                <p>There are no events, to register new event  <span (click)="goToEventRegister()" color="primary"><b>click here</b></span></p>
              </ion-item-divider>
            </ion-item-group>
          </ion-col>
        </ion-row>
      </div>

      <div *ngIf="eventListSections.length > 0">
        <!-- event list --->
        <div *ngFor="let section of eventListSections">
          <div *ngIf="section.id == currentPage">
            <div *ngFor="let event of section.events">
              <ion-card >
                <ion-card-content>
                  <p><b>Incident date</b>&nbsp;&nbsp;:&nbsp;&nbsp;{{ event.eventDate }}</p>
                  <div *ngFor="let dataValue of event.dataValues">
                    <div *ngIf="dataElementToDisplay[dataValue.dataElement]">
                      <p><b>{{ dataElementToDisplay[dataValue.dataElement].name }}</b>&nbsp;&nbsp;:&nbsp;&nbsp;{{ dataValue.value }}</p>
                    </div>
                  </div>
                  <p><b>Status</b>&nbsp;&nbsp;:&nbsp;&nbsp;
                    <span *ngIf="event.syncStatus == 'new event' || event.syncStatus == 'not synced'" >Offline</span>
                    <span *ngIf="!(event.syncStatus == 'new event' || event.syncStatus == 'not synced')" >Online</span>
                  </p>
                  <!-- edit or view event actions -->
                  <ion-row>
                    <ion-col >
                      <button ion-button full (click)="goToEventView(event)">
                        <ion-icon name="eye"></ion-icon>&nbsp;&nbsp;View
                      </button>
                    </ion-col>
                    <ion-col >
                      <button ion-button full (click)="gotToEditEvent(event)">
                        <ion-icon name="create"></ion-icon>&nbsp;&nbsp;Edit
                      </button>
                    </ion-col>
                  </ion-row>

                </ion-card-content>
              </ion-card>
            </div>
          </div>
        </div>


        <!-- pagination -->
        <ion-item-group>
          <ion-item-divider>
            <ion-row>
              <ion-col>
                <button color="dark" ion-button full clear small (click)="changePagination(0)">
                  <ion-icon name="ios-arrow-back-outline"></ion-icon>
                  <ion-icon name="ios-arrow-back-outline"></ion-icon>
                  <ion-icon name="ios-arrow-back-outline"></ion-icon>
                  <ion-icon name="ios-arrow-back-outline"></ion-icon>
                </button>
              </ion-col>
              <ion-col>
                <button color="dark" ion-button full clear small (click)="changePagination(currentPage - 1)">
                  <ion-icon name="ios-arrow-back-outline"></ion-icon>
                  <ion-icon name="ios-arrow-back-outline"></ion-icon>
                </button>
              </ion-col>
              <ion-col>
                <button ion-button color="dark" full clear small >
                  {{ paginationLabel }}
                </button>
              </ion-col>
              <ion-col >
                <button color="dark" ion-button full clear small (click)="changePagination(currentPage + 1)">
                  <ion-icon name="ios-arrow-forward-outline"></ion-icon>
                  <ion-icon name="ios-arrow-forward-outline"></ion-icon>
                </button>
              </ion-col>

              <ion-col >
                <button color="dark" ion-button full clear small (click)="changePagination(entryFormSections.length -1)">
                  <ion-icon name="ios-arrow-forward-outline"></ion-icon>
                  <ion-icon name="ios-arrow-forward-outline"></ion-icon>
                  <ion-icon name="ios-arrow-forward-outline"></ion-icon>
                  <ion-icon name="ios-arrow-forward-outline"></ion-icon>
                </button>
              </ion-col>

            </ion-row>
          </ion-item-divider>
        </ion-item-group>
        <!-- pagination -->
        <!--<ion-row >-->
          <!--<ion-col width-33>-->
            <!--<button color="primary" ion-button full (click)="changePagination(currentPage - 1)">-->
              <!--Previous-->
            <!--</button>-->
          <!--</ion-col>-->
          <!--<ion-col width-33>-->
            <!--<button ion-button color="primary" full clear>-->
              <!--{{ paginationLabel }}-->
            <!--</button>-->
          <!--</ion-col>-->
          <!--<ion-col width-33>-->
            <!--<button color="primary" ion-button full (click)="changePagination(currentPage + 1)">-->
              <!--Next-->
            <!--</button>-->
          <!--</ion-col>-->
        <!--</ion-row>-->
      </div>
    </div>

  </div>

</ion-content>
